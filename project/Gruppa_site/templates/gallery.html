{% extends "base.html" %}
{% block title %}Galereya{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fa-solid fa-images me-2"></i>Galereya</h2>
    {% if session.admin %}
    <a href="/admin/panel" class="btn btn-primary btn-sm">
      <i class="fa-solid fa-plus me-1"></i>Yangi rasmlar qo'shish
    </a>
    {% endif %}
  </div>

  {% if gallery %}
  <div class="row">
    {% for item in gallery %}
    <div class="col-12 mb-4">
      <div class="card cyber-card">
        <div class="card-header bg-warning text-dark">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-0">{{ item.title }}</h5>
              {% if item.description %}
              <p class="mb-0 mt-1 small">{{ item.description }}</p>
              {% endif %}
            </div>
            <div class="text-end">
              <small class="text-muted">{{ item.created_at[:10] }}</small>
              {% if item.image %}
              <br>
              <small class="text-muted">
                <i class="fa-solid fa-images me-1"></i>
                {{ item.image.split(',')|length }} ta rasm
              </small>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="card-body p-3">
          {% if item.image %}
            {% set images = item.image.split(',') %}
            {% set image_count = images|length %}
            
            {# 1 ta rasm #}
            {% if image_count == 1 %}
            <div class="row justify-content-center">
              <div class="col-md-8 col-lg-6">
                <img src="{{ url_for('static', filename='uploads/' + images[0]) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="max-height: 500px; width: 100%; object-fit: cover;">
              </div>
            </div>
            
            {# 2 ta rasm #}
            {% elif image_count == 2 %}
            <div class="row">
              {% for image in images %}
              <div class="col-md-6 mb-3">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 300px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            
            {# 3 ta rasm #}
            {% elif image_count == 3 %}
            <div class="row">
              {% for image in images %}
              <div class="col-md-4 mb-3">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 250px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            
            {# 4 ta rasm #}
            {% elif image_count == 4 %}
            <div class="row">
              {% for image in images %}
              <div class="col-md-3 mb-3">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 200px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            
            {# 5 ta rasm #}
            {% elif image_count == 5 %}
            <div class="row">
              {# Birinchi qator: 3 ta rasm #}
              {% for image in images[:3] %}
              <div class="col-md-4 mb-3">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 200px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            <div class="row justify-content-center">
              {# Ikkinchi qator: 2 ta rasm #}
              {% for image in images[3:5] %}
              <div class="col-md-6 mb-3">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 200px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            
            {# 6 yoki undan ko'p rasm #}
            {% else %}
            <div class="row">
              {% for image in images %}
              <div class="col-md-4 col-lg-3 mb-3">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 180px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            {% endif %}
            
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info text-center">
    <h5><i class="fa-solid fa-images me-2"></i>Galereya hozircha bo'sh</h5>
    <p class="mb-3">Admin panel orqali yangi rasmlar qo'shishingiz mumkin</p>
    {% if session.admin %}
    <a href="/admin/panel" class="btn btn-primary">
      <i class="fa-solid fa-user-shield me-1"></i>Admin Panelga o'tish
    </a>
    {% else %}
    <a href="/admin" class="btn btn-primary">
      <i class="fa-solid fa-right-to-bracket me-1"></i>Admin kirish
    </a>
    {% endif %}
  </div>
  {% endif %}
</div>

<style>
.gallery-img {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
}

.gallery-img:hover {
  transform: scale(1.03);
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

/* Kichik ekranlar uchun moslashtirish */
@media (max-width: 768px) {
  .gallery-img {
    height: 200px !important;
  }
}
</style>

<script>
// Rasmni bosganda kattalashtirish
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.gallery-img').forEach(img => {
    img.addEventListener('click', function() {
      const src = this.src;
      const modal = `
        <div class="modal fade" id="imageModal" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body text-center">
                <img src="${src}" class="img-fluid" style="max-height: 80vh;">
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modal);
      const imageModal = new bootstrap.Modal(document.getElementById('imageModal'));
      imageModal.show();
      
      // Modal yopilganda o'chirish
      document.getElementById('imageModal').addEventListener('hidden.bs.modal', function () {
        this.remove();
      });
    });
  });
});
</script>
{% endblock %}