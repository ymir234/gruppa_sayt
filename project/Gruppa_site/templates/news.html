{% extends "base.html" %}
{% block title %}Yangiliklar{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fa-solid fa-newspaper me-2"></i>Yangiliklar va E'lonlar</h2>
    {% if session.admin %}
    <a href="/admin/panel" class="btn btn-primary btn-sm">
      <i class="fa-solid fa-plus me-1"></i>Yangi yangilik qo'shish
    </a>
    {% endif %}
  </div>

  <div class="row">
    <div class="col-lg-8">
      {% for item in news %}
      <div class="card news-card mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <h4 class="card-title news-title">{{ item.title }}</h4>
            <div class="text-end">
              <span class="badge bg-danger">Yangi</span>
              <br>
              <small class="text-muted">{{ item.created_at[:10] }}</small>
            </div>
          </div>
          
          <p class="card-text news-content mb-3">{{ item.content }}</p>
          
          {% if item.images %}
            {% set images = item.images.split(',') %}
            {% set image_count = images|length %}
            
            {# 1 ta rasm #}
            {% if image_count == 1 %}
            <div class="row justify-content-center mb-3">
              <div class="col-md-8">
                <img src="{{ url_for('static', filename='uploads/' + images[0]) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="max-height: 400px; width: 100%; object-fit: cover;">
              </div>
            </div>
            
            {# 2 ta rasm #}
            {% elif image_count == 2 %}
            <div class="row mb-3">
              {% for image in images %}
              <div class="col-md-6 mb-2">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 250px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            
            {# 3 ta rasm #}
            {% elif image_count == 3 %}
            <div class="row mb-3">
              {% for image in images %}
              <div class="col-md-4 mb-2">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 200px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            
            {# 4 ta rasm #}
            {% elif image_count == 4 %}
            <div class="row mb-3">
              {% for image in images %}
              <div class="col-md-3 mb-2">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 180px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            
            {# 5 ta rasm #}
            {% elif image_count == 5 %}
            <div class="row mb-3">
              {# Birinchi qator: 3 ta rasm #}
              {% for image in images[:3] %}
              <div class="col-md-4 mb-2">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 180px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            <div class="row justify-content-center mb-3">
              {# Ikkinchi qator: 2 ta rasm #}
              {% for image in images[3:5] %}
              <div class="col-md-6 mb-2">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 180px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            
            {# 6 yoki undan ko'p rasm #}
            {% else %}
            <div class="row mb-3">
              {% for image in images %}
              <div class="col-md-4 col-lg-3 mb-2">
                <img src="{{ url_for('static', filename='uploads/' + image) }}" 
                     class="img-fluid rounded gallery-img" 
                     alt="{{ item.title }}"
                     style="height: 150px; width: 100%; object-fit: cover;">
              </div>
              {% endfor %}
            </div>
            {% endif %}
            
          {% endif %}
          
          <div class="d-flex justify-content-between align-items-center mt-3 pt-3 border-top">
            <small class="text-muted">
              <i class="fa-solid fa-calendar me-1"></i>{{ item.created_at[:10] }}
            </small>
            <small class="text-muted">
              <i class="fa-solid fa-images me-1"></i>
              {{ images|length if item.images else 0 }} ta rasm
            </small>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- gallery.html dagi style va script larni qo'shing -->
<style>
.gallery-img {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
}

.gallery-img:hover {
  transform: scale(1.03);
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

@media (max-width: 768px) {
  .gallery-img {
    height: 200px !important;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.gallery-img').forEach(img => {
    img.addEventListener('click', function() {
      const src = this.src;
      const modal = `
        <div class="modal fade" id="imageModal" tabindex="-1">
          <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body text-center">
                <img src="${src}" class="img-fluid" style="max-height: 80vh;">
              </div>
            </div>
          </div>
        </div>
      `;
      
      document.body.insertAdjacentHTML('beforeend', modal);
      const imageModal = new bootstrap.Modal(document.getElementById('imageModal'));
      imageModal.show();
      
      document.getElementById('imageModal').addEventListener('hidden.bs.modal', function () {
        this.remove();
      });
    });
  });
});
</script>
{% endblock %}